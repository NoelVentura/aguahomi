---
// Header.astro - Navegación principal de AGUAHOMI
import ThemeToggle from './ThemeToggle.astro';

interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

const navLinks = [
  { href: '/', label: 'Inicio' },
  { href: '/sabores', label: 'Sabores' },
  { href: '/nosotros', label: 'Nosotros' },
  { href: '/contacto', label: 'Contacto' },
];
---

<header 
  class="fixed top-0 left-0 right-0 z-50 
         bg-white/90 dark:bg-slate-900/90 
         backdrop-blur-md 
         border-b border-agua-100 dark:border-slate-800
         transition-all duration-300"
>
  <nav class="container-custom" aria-label="Navegación principal">
    <div class="flex items-center justify-between h-16 md:h-20">
      
      <!-- Logo -->
      <a 
        href="/" 
        class="flex items-center gap-2 group"
        aria-label="AGUAHOMI - Ir al inicio"
      >
        <!-- Ícono de gota de agua -->
        <div class="relative">
          <svg 
            class="w-10 h-10 text-agua-500 group-hover:text-agua-600 transition-colors duration-300"
            viewBox="0 0 24 24" 
            fill="currentColor"
            aria-hidden="true"
          >
            <path d="M12 2C12 2 5 10 5 14.5C5 18.09 8.13 21 12 21C15.87 21 19 18.09 19 14.5C19 10 12 2 12 2ZM12 19C9.24 19 7 16.76 7 14.5C7 12.86 8.78 10.05 12 6.07C15.22 10.05 17 12.86 17 14.5C17 16.76 14.76 19 12 19Z"/>
            <circle cx="12" cy="14.5" r="3" class="text-fresca-400" fill="currentColor" opacity="0.6"/>
          </svg>
          <div class="absolute -top-1 -right-1 w-3 h-3 bg-sabor-400 rounded-full animate-pulse"></div>
        </div>
        <span class="text-xl md:text-2xl font-display font-bold text-gradient">
          AGUAHOMI
        </span>
      </a>

      <!-- Navegación Desktop -->
      <div class="hidden md:flex items-center gap-8">
        <ul class="flex items-center gap-6" role="menubar">
          {navLinks.map((link) => (
            <li role="none">
              <a
                href={link.href}
                role="menuitem"
                class:list={[
                  'relative px-2 py-1 font-medium transition-colors duration-300',
                  'hover:text-agua-600 dark:hover:text-agua-400',
                  'after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5',
                  'after:bg-gradient-to-r after:from-agua-500 after:to-fresca-500',
                  'after:scale-x-0 after:origin-right after:transition-transform after:duration-300',
                  'hover:after:scale-x-100 hover:after:origin-left',
                  currentPath === link.href 
                    ? 'text-agua-600 dark:text-agua-400 after:scale-x-100' 
                    : 'text-agua-800 dark:text-agua-200'
                ]}
                aria-current={currentPath === link.href ? 'page' : undefined}
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>

        <!-- Toggle de Tema -->
        <ThemeToggle />
      </div>

      <!-- Botón Menú Mobile -->
      <div class="flex items-center gap-4 md:hidden">
        <ThemeToggle />
        <button
          id="mobile-menu-button"
          type="button"
          class="inline-flex items-center justify-center p-2 
                 rounded-lg text-agua-700 dark:text-agua-300
                 hover:bg-agua-100 dark:hover:bg-slate-800
                 focus:outline-none focus:ring-2 focus:ring-agua-500
                 transition-colors duration-300"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-label="Abrir menú de navegación"
        >
          <!-- Ícono Hamburguesa -->
          <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <!-- Ícono Cerrar -->
          <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Menú Mobile -->
    <div 
      id="mobile-menu" 
      class="md:hidden hidden overflow-hidden transition-all duration-300 ease-out"
      aria-label="Menú de navegación móvil"
    >
      <ul class="py-4 space-y-2" role="menu">
        {navLinks.map((link) => (
          <li role="none">
            <a
              href={link.href}
              role="menuitem"
              class:list={[
                'block px-4 py-3 rounded-lg font-medium transition-all duration-300',
                'hover:bg-agua-50 dark:hover:bg-slate-800',
                currentPath === link.href 
                  ? 'bg-agua-50 dark:bg-slate-800 text-agua-600 dark:text-agua-400' 
                  : 'text-agua-800 dark:text-agua-200'
              ]}
              aria-current={currentPath === link.href ? 'page' : undefined}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>
</header>

<!-- Espaciador para compensar el header fixed -->
<div class="h-16 md:h-20"></div>

<script>
  function initMobileMenu() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    if (!mobileMenuButton || !mobileMenu || !menuIcon || !closeIcon) return;

    let isOpen = false;

    mobileMenuButton.addEventListener('click', () => {
      isOpen = !isOpen;
      
      mobileMenu.classList.toggle('hidden', !isOpen);
      menuIcon.classList.toggle('hidden', isOpen);
      closeIcon.classList.toggle('hidden', !isOpen);
      mobileMenuButton.setAttribute('aria-expanded', String(isOpen));

      // Animación de altura
      if (isOpen) {
        mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
      } else {
        mobileMenu.style.maxHeight = '0';
      }
    });

    // Cerrar menú al hacer click en un enlace
    mobileMenu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        isOpen = false;
        mobileMenu.classList.add('hidden');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        mobileMenu.style.maxHeight = '0';
      });
    });
  }

  initMobileMenu();
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
